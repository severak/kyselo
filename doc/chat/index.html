<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>WebSockets - Simple chat</title>
    <style>
        * { font-family:tahoma; font-size:12px; padding:0px;margin:0px;}
        p { line-height:18px; }
        div { width:500px; margin-left:auto; margin-right:auto;}
        #content { padding:5px; background:#ddd; border-radius:5px;
            overflow-y: scroll; border:1px solid #CCC;
            margin-top:10px; height: 160px; }
        #input { border-radius:2px; border:1px solid #ccc;
            margin-top:10px; padding:5px; width:400px;
        }
        #status { width:88px;display:block;float:left;margin-top:15px; }
    </style>
    <script src="uboot.js"></script>
</head>
<body>
<div id="content">loading...</div>
<div>
    <span id="status">Connecting...</span>

        <input type="text" id="input"/>
        <button id="send">send!</button>
</div>

<script>
ub.whenReady(function () {
    var userName = 'pepa';
    var connection = new WebSocket('ws://127.0.0.1:1337');

    var input = ub.gebi('input');

    connection.onopen = function() {
        connection.send(JSON.stringify({act: 'login', user: userName}));
    };

    connection.onerror = function(err) {
        console.log(err);
    };

    connection.onmessage = function (message) {
        var recieved = JSON.parse(message.data);

        var act = recieved.act || '?';

        if (act=='welcome' && recieved.history) {
            ub.gebi('content').innerText = JSON.stringify(recieved.history);
        }
    };

    ub.on('send', 'click', function (ev) {
        // TODO - proč se nechce pověsit na enter v poli?
        // TODO - protože se to musí chytat na formu
        ub.stop(ev);

        var text = input.value;

        input.value = '';

        connection.send(JSON.stringify({act: 'message', user: userName, message: text}))
    });
});

</script>

</body>
</html>
